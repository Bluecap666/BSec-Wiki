# 工作组

## 1. 工作组概念

### 1.1 基本定义

工作组是一种**对等网络**组织模式，网络中的每台计算机都是独立的自治系统，彼此之间没有从属关系。

### 1.2 核心特征

* **分散式管理** ：每台计算机独立管理自己的资源和安全策略
* **无中心控制** ：没有域控制器这样的集中管理节点
* **扁平化结构** ：所有计算机逻辑上处于同一层级
* **本地身份验证** ：身份验证在各计算机本地完成

## 2. 创建和加入工作组

### 2.1 默认设置

* Windows系统默认工作组名：**`WORKGROUP`**

### 2.2 创建新工作组

**powershell**

```
# 通过系统GUI操作
1. 右键"此电脑" → 属性 → 更改设置
2. 计算机名选项卡 → 更改
3. 选择"工作组"，输入新工作组名称
4. 重启生效

# 通过命令行（需要管理员权限）
wmic computersystem where name="%computername%" call joindomainorworkgroup name="新工作组名"
```

### 2.3 加入现有工作组

* **无认证要求** ：加入工作组不需要任何身份验证
* **即时生效** ：更改工作组名后重启计算机即可
* **多工作组共存** ：同一网络中可存在多个不同名称的工作组

## 3. 网络结构

### 3.1 对等网络架构

```
计算机A (WORKGROUP) ↔ 计算机B (WORKGROUP) ↔ 计算机C (WORKGROUP)
      ↓                      ↓                      ↓
  本地SAM数据库          本地SAM数据库          本地SAM数据库
```

### 3.2 网络发现机制

* **广播查询** ：通过广播包发现网络中的其他计算机
* **浏览器服务** ：维护网络邻居中的计算机列表
* **主机名解析** ：依赖NetBIOS名称解析

## 4. 关键协议

### 4.1 NetBIOS over TCP/IP

* **端口** ：137/UDP(名称服务), 138/UDP(数据报服务), 139/TCP(会话服务)
* **功能** ：提供名称注册、名称解析、会话建立
* **名称解析** ：将计算机名解析为IP地址

### 4.2 SMB/CIFS

* **端口** ：445/TCP
* **功能** ：文件共享、打印机共享、进程间通信
* **版本** ：SMBv1(不安全), SMBv2, SMBv3(推荐)

### 4.3 LLMNR/NBNS

* **LLMNR** ：本地链接多播名称解析(5355/UDP)
* **NBNS** ：NetBIOS名称服务(137/UDP)
* **作用** ：DNS解析失败时的备用名称解析机制

## 5. 资源访问流程

### 5.1 访问流程详解

```
用户A@计算机A → 访问 \\计算机B\共享文件夹
                    ↓
            计算机B接收访问请求
                    ↓
      计算机B检查本地SAM数据库
                    ↓
    验证用户名/密码是否匹配
                    ↓
        检查共享权限 + NTFS权限
                    ↓
          授权访问或拒绝访问
```

### 5.2 身份验证过程

1. **凭据传递** ：计算机A将用户A的凭据发送给计算机B
2. **本地验证** ：计算机B在自己的SAM数据库中验证凭据
3. **权限检查** ：验证通过后检查该本地用户对资源的权限
4. **访问决策** ：基于权限组合决定允许或拒绝访问

## 6. 资源权限体系

### 6.1 共享权限

| 权限级别           | 描述                                  |
| ------------------ | ------------------------------------- |
| **读取**     | 查看文件名和子文件夹、读取文件内容    |
| **更改**     | 读取权限 + 创建/修改/删除文件和文件夹 |
| **完全控制** | 更改权限 + 修改权限设置               |

### 6.2 NTFS权限

| 基本权限      | 高级权限               |
| ------------- | ---------------------- |
| • 完全控制   | • 遍历文件夹/执行文件 |
| • 修改       | • 列出文件夹/读取数据 |
| • 读取和执行 | • 读取属性            |
| • 读取       | • 创建文件/写入数据   |
| • 写入       | • 创建文件夹/附加数据 |
|               | • 写入属性            |
|               | • 删除子文件夹和文件  |
|               | • 删除                |
|               | • 读取权限            |
|               | • 更改权限            |
|               | • 取得所有权          |

### 6.3 有效权限计算

```
最终权限 = 共享权限 ∩ NTFS权限
```

* **取最严格权限** ：两种权限取交集
* **拒绝优先** ：任何显式拒绝都会覆盖允许权限

## 7. 账户权限管理

### 7.1 本地用户账户

* **存储位置** ：本地SAM数据库
* **账户类型** ：管理员、标准用户、Guest
* **密码策略** ：每台计算机独立设置

### 7.2 默认账户

```
# 内置本地账户
- Administrator # 本地管理员账户
- Guest         # 来宾账户（默认禁用）
- 用户创建的本地账户
```

### 7.3 用户权限级别

| 权限级别           | 能力范围                                           |
| ------------------ | -------------------------------------------------- |
| **管理员**   | 完全控制系统、安装软件、修改系统设置、管理其他用户 |
| **标准用户** | 运行应用程序、访问个人文件、有限系统设置修改       |
| **Guest**    | 极有限访问权限，通常仅用于临时访问                 |

## 8. 资源CRUD操作

### 8.1 创建资源

**powershell**

```
# 创建共享文件夹
net share 共享名=驱动器:\路径 [/GRANT:用户,权限]

# 示例
net share DataShare=C:\Data /GRANT:Everyone,READ
```

### 8.2 读取资源

**powershell**

```
# 查看网络共享
net view \\计算机名

# 查看本地共享
net share

# 访问共享资源
\\计算机名\共享名
```

### 8.3 更新资源

**powershell**

```
# 修改共享权限
net share 共享名 /GRANT:用户,新权限

# 停止共享
net share 共享名 /DELETE
```

### 8.4 删除资源

**powershell**

```
# 删除共享
net share 共享名 /DELETE

# 通过GUI删除：计算机管理 → 共享文件夹 → 共享
```

## 9. 安全管理要点

### 9.1 账户安全

* 重命名Administrator账户
* 禁用Guest账户
* 实施强密码策略
* 定期审查本地用户

### 9.2 共享安全

* 遵循最小权限原则
* 避免对Everyone组授予完全控制
* 定期审查和清理不必要的共享
* 使用基于访问的枚举

### 9.3 网络安全

* 禁用不必要的协议（如SMBv1）
* 配置防火墙规则
* 考虑禁用LLMNR/NBNS
* 实施网络分段

## 10. 适用场景与限制

### 10.1 适用场景

* 小型办公室/家庭网络（10台计算机以内）
* 临时性项目组网络
* 测试和开发环境
* 预算有限的场景

### 10.2 局限性

* **扩展性差** ：超过20台计算机难以管理
* **管理复杂** ：每台计算机需单独配置
* **安全薄弱** ：缺乏统一安全策略
* **效率低下** ：用户需记忆多套凭据
